load("//build:variables.bzl", "DUCHY_K8S_SETTINGS", "EDP_SIMULATOR_K8S_SETTINGS", "FRONTEND_SIMULATOR_K8S_SETTINGS", "KINGDOM_K8S_SETTINGS")
load("//src/main/k8s:macros.bzl", "cue_dump")

cue_dump(
    name = "kingdom_gke",
    srcs = ["kingdom_gke.cue"],
    cue_tags = {
        "secret_name": KINGDOM_K8S_SETTINGS.secret_name,
    },
    tags = ["manual"],
    deps = [
        "//src/main/k8s:kingdom",
    ],
)

cue_dump(
    name = "resource_setup_gke",
    srcs = ["resource_setup_gke.cue"],
    cue_tags = {
        "secret_name": KINGDOM_K8S_SETTINGS.secret_name,
    },
    tags = ["manual"],
    deps = [
        "//src/main/k8s:resource_setup",
    ],
)

cue_dump(
    name = "duchy_gke",
    srcs = ["duchy_gke.cue"],
    cue_tags = {
        "duchy_name": DUCHY_K8S_SETTINGS.duchy_name,
        "duchy_cert_name": DUCHY_K8S_SETTINGS.duchy_cert_name,
        "duchy_protocols_setup_config": DUCHY_K8S_SETTINGS.duchy_protocols_setup_config,
        "secret_name": DUCHY_K8S_SETTINGS.secret_name,
    },
    tags = ["manual"],
    deps = [
        "//src/main/k8s:base",
        "//src/main/k8s:duchy",
    ],
)

cue_dump(
    name = "edp_simulator_gke",
    srcs = ["edp_simulator_gke.cue"],
    cue_tags = {
        "mc_name": EDP_SIMULATOR_K8S_SETTINGS.mc_name,
        "edp1_name": EDP_SIMULATOR_K8S_SETTINGS.edp1_name,
        "edp2_name": EDP_SIMULATOR_K8S_SETTINGS.edp2_name,
        "edp3_name": EDP_SIMULATOR_K8S_SETTINGS.edp3_name,
        "edp4_name": EDP_SIMULATOR_K8S_SETTINGS.edp4_name,
        "edp5_name": EDP_SIMULATOR_K8S_SETTINGS.edp5_name,
        "edp6_name": EDP_SIMULATOR_K8S_SETTINGS.edp6_name,
        "secret_name": EDP_SIMULATOR_K8S_SETTINGS.secret_name,
    },
    tags = ["manual"],
    deps = [
        "//src/main/k8s:edp_simulator",
    ],
)

cue_dump(
    name = "frontend_simulator_gke",
    srcs = ["frontend_simulator_gke.cue"],
    cue_tags = {
        "mc_name": FRONTEND_SIMULATOR_K8S_SETTINGS.mc_name,
        "mc_api_key": FRONTEND_SIMULATOR_K8S_SETTINGS.mc_api_key,
        "secret_name": FRONTEND_SIMULATOR_K8S_SETTINGS.secret_name,
    },
    tags = ["manual"],
    deps = [
        "//src/main/k8s:base",
        "//src/main/k8s:frontend_simulator",
    ],
)

filegroup(
    name = "k8s_kingdom_deployment_config",
    srcs = [
        ":kingdom_gke.yaml",
        ":resource_setup_gke.yaml",
    ],
    tags = ["manual"],
    visibility = [
        "//src/main/kotlin/org/wfanet/measurement/tools:__subpackages__",
    ],
)

filegroup(
    name = "k8s_duchy_deployment_config",
    srcs = [
        ":duchy_gke.yaml",
    ],
    tags = ["manual"],
    visibility = [
        "//src/main/kotlin/org/wfanet/measurement/tools:__subpackages__",
    ],
)

filegroup(
    name = "k8s_edp_simulator_deployment_config",
    srcs = [
        ":edp_simulator_gke.yaml",
    ],
    tags = ["manual"],
    visibility = [
        "//src/main/kotlin/org/wfanet/measurement/tools:__subpackages__",
    ],
)

filegroup(
    name = "k8s_frontend_simulator_deployment_config",
    srcs = [
        ":frontend_simulator_gke.yaml",
    ],
    tags = ["manual"],
    visibility = [
        "//src/main/kotlin/org/wfanet/measurement/tools:__subpackages__",
    ],
)
