load("@wfa_rules_kotlin_jvm//kotlin:defs.bzl", "kt_jvm_binary", "kt_jvm_library")

package(default_visibility = [
    "//src/main/kotlin/org/wfanet/measurement/edpaggregator:__subpackages__",
    "//src/main/kotlin/org/wfanet/measurement/loadtest/edpaggregator/testing:__subpackages__",
    "//src/test/kotlin/org/wfanet/measurement/edpaggregator:__subpackages__",
])

kt_jvm_library(
    name = "storage_config",
    srcs = ["StorageConfig.kt"],
)

kt_jvm_library(
    name = "encrypted_storage",
    srcs = ["EncryptedStorage.kt"],
    deps = [
        "//src/main/proto/wfa/measurement/edpaggregator/v1alpha:blob_details_kt_jvm_proto",
        "//src/main/proto/wfa/measurement/edpaggregator/v1alpha:encrypted_dek_kt_jvm_proto",
        "@wfa_common_jvm//imports/java/com/google/protobuf",
        "@wfa_common_jvm//src/main/kotlin/org/wfanet/measurement/common/crypto/tink",
        "@wfa_common_jvm//src/main/kotlin/org/wfanet/measurement/storage:mesos_recordio_storage_client",
    ],
)

kt_jvm_binary(
    name = "StandaloneResultsFulfiller",
    srcs = ["StandaloneResultsFulfiller.kt"],
    main_class = "org.wfanet.measurement.edpaggregator.StandaloneResultsFulfillerKt",
    deps = [
        ":storage_config",
        "//src/main/kotlin/org/wfanet/measurement/api/v2alpha:resource_key",
        "//src/main/kotlin/org/wfanet/measurement/dataprovider:requisition_fulfiller",
        "//src/main/kotlin/org/wfanet/measurement/edpaggregator/resultsfulfiller:results_fulfiller",
        "//src/main/kotlin/org/wfanet/panelmatch/common",
        "//src/main/proto/wfa/panelmatch/client/eventpreprocessing:preprocess_events_kt_jvm_proto",
        "//src/main/proto/wfa/panelmatch/client/exchangetasks:join_key_exchange_kt_jvm_proto",
        "//src/main/proto/wfa/panelmatch/common/compression:compression_kt_jvm_proto",
        "@wfa_common_jvm//imports/java/com/google/protobuf",
        "@wfa_common_jvm//imports/java/picocli",
        "@wfa_common_jvm//src/main/kotlin/org/wfanet/measurement/common",
        "@wfa_virtual_people_common//src/main/proto/wfa/virtual_people/common:event_kt_jvm_proto",
    ],
)
