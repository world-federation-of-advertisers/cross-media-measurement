# E2E Correctness Test

E2E Correctness test is a test that reports generated by the MPC protocol as run
by the Kingdom and a set of Duchies on GCP yield approximately the same
cardinality and frequency estimates as those run locally directly on the raw,
unencrypted data.

## Set up

*   Default spanner instance is QA instance in the Open Measurement GCP account.
    You can spin up local Spanner cluster and provide;

    --spanner-emulator-host=localhost:8080

*   Set destination output directory, test will automatically create subfolders;

    --output-directory=correctness

*   Set Publisher Data Service target correctly;

    --publisher-data-service-target=localhost:8080

### Sample Usage

###### 2 Data Providers 1 campaign each

```
bazel build //src/main/kotlin/org/wfanet/measurement/loadtest:CorrectnessRunner
bazel-bin/src/main/kotlin/org/wfanet/measurement/loadtest/CorrectnessRunner --output-directory=correctness --run-id= --publisher-data-service-target="localhost:8080" --spanner-project=ads-open-measurement --spanner-instance=qa-instance --spanner-database=local-measurement-providers --spanner-emulator-host= --sketch-config-file=src/main/kotlin/org/wfanet/measurement/loadtest/config/liquid_legions_sketch_config.textproto
```

##### 5 Data Providers with 5 Campaigns each

```
bazel build //src/main/kotlin/org/wfanet/measurement/loadtest:CorrectnessRunner
bazel-bin/src/main/kotlin/org/wfanet/measurement/loadtest/CorrectnessRunner --data-provider-count=5 --campaign-count=5 --output-directory=correctness --run-id= --publisher-data-service-target="localhost:8080" --spanner-project=ads-open-measurement --spanner-instance=qa-instance --spanner-database=local-measurement-providers --spanner-emulator-host= --sketch-config-file=src/main/kotlin/org/wfanet/measurement/loadtest/config/liquid_legions_sketch_config.textproto
```
